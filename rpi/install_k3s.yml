---
- hosts: master
  become: yes
  tasks:
  - name: Install k3s
    shell: |
      curl -sfL https://get.k3s.io | sh -
      sudo systemctl status k3s
      sudo cat /var/lib/rancher/k3s/server/node-token

- hosts: rpi 
  become: yes
  tasks:
  - name: Install k3sup
    shell: |
      curl -sLS https://get.k3sup.dev | sh
      sudo install k3sup /usr/local/bin/

  - name: Install arkade
    shell: curl -sLS https://get.arkade.dev | sudo sh




  - name: Install k3s 
    shell: /usr/local/bin/k3s-uninstall.sh
    when: k3s.stat.exist is defined

  - name: Install k3s agent
    shell: /usr/local/bin/k3s-agent-uninstall.sh 
    when: k3sagent.stat.exist is defined

  - name: Install kubernetes-client
    ansible.builtin.package:
      name: kubernetes-client
      state: absent
